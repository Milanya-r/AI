<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>Super GPT-4.1 Chat</title>
  <style>
    :root { --bg:#111; --fg:#eee; --accent:#3b82f6; --user:#4ade80; --bot:#60a5fa; }
    body {margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--fg);display:flex;height:100vh;}
    #app {width:100%;max-width:720px;margin:auto;display:flex;flex-direction:column;padding:10px;}
    #log {flex:1;overflow-y:auto;padding:10px;border:1px solid #333;border-radius:8px;background:#1e1e1e;}
    .msg {margin:6px 0;}
    .user {color:var(--user);text-align:right;}
    .bot {color:var(--bot);}
    #box {display:flex;margin-top:8px;gap:6px;}
    #input{flex:1;padding:8px;border:1px solid #444;border-radius:4px;background:#222;color:var(--fg);}
    button{padding:8px 12px;border:none;border-radius:4px;background:var(--accent);color:#fff;cursor:pointer;}
    select{margin-left:6px;padding:6px;border-radius:4px;background:#222;color:var(--fg);}
    .hidden{display:none;}
  </style>
</head>

<body>
  <div id="app">
    <!-- 1. –ß–∞—Ç -->
    <div id="log"></div>

    <!-- 2. –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div id="box">
      <input id="input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ / –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ / URL –∫–∞—Ä—Ç–∏–Ω–∫–∏" autocomplete="off"/>
      <select id="model">
        <option value="gpt-4.1">gpt-4.1</option>
        <option value="gpt-4o">gpt-4o</option>
        <option value="o3-mini">o3-mini</option>
      </select>
      <button id="chatBtn">üí¨</button>
      <button id="dalleBtn">üñºÔ∏è DALL-E</button>
      <button id="visionBtn">üëÅÔ∏è Vision</button>
    </div>
  </div>

  <script src="https://js.puter.com/v2/"></script>
  <script>
    const log   = document.getElementById('log');
    const input = document.getElementById('input');
    const model = document.getElementById('model');
    const chatBtn  = document.getElementById('chatBtn');
    const dalleBtn = document.getElementById('dalleBtn');
    const visionBtn= document.getElementById('visionBtn');

    function add(text, cls='bot') {
      const p = document.createElement('div');
      p.className = 'msg ' + cls;
      p.textContent = text;
      log.appendChild(p);
      log.scrollTop = log.scrollHeight;
    }

    async function stream(prompt, mode='chat') {
      add(mode === 'chat' ? prompt : '–ó–∞–ø—Ä–æ—Å: ' + prompt, 'user');
      add('‚è≥ –ø–µ—á–∞—Ç–∞–µ—Ç...', 'bot');
      const last = log.lastChild;

      try {
        if (mode === 'chat') {
          const res = await puter.ai.chat(prompt, {model: model.value, stream: true});
          let txt = '';
          for await (const chunk of res) txt += chunk.text || '';
          last.textContent = txt;
        } else if (mode === 'dalle') {
          const img = await puter.ai.txt2img(prompt);
          last.replaceChildren(img);
        } else if (mode === 'vision') {
          const url = prompt.trim();
          const res = await puter.ai.chat('–ß—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ?', url, {model: model.value});
          last.textContent = res;
        }
      } catch (e) { last.textContent = '–û—à–∏–±–∫–∞: ' + e.message; }
    }

    chatBtn.onclick   = () => stream(input.value, 'chat');
    dalleBtn.onclick  = () => stream(input.value, 'dalle');
    visionBtn.onclick = () => stream(input.value, 'vision');
    input.addEventListener('keydown', e => e.key === 'Enter' && chatBtn.click());
  </script>
</body>
</html>
